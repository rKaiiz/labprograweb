<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Panel de administraciÃ³n Â· La Media Docena</title>

  <link rel="stylesheet" href="assets/css/styles.css"/>

  <!-- Scripts globales -->
  <script defer src="assets/js/data.js"></script>
  <script defer src="assets/js/main.js"></script>
</head>
<body data-page="admin">
  <main class="container">
    <!-- Encabezado -->
    <header style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;margin-bottom:16px">
      <div>
        <h1 style="margin:0">Panel de administraciÃ³n</h1>
        <p style="margin:4px 0 0;font-size:13px;color:#555;max-width:520px">
          Desde aquÃ­ puedes gestionar el menÃº, las reservaciones, los pedidos, las reseÃ±as de clientes,
          la informaciÃ³n de contacto y los usuarios del sistema.
        </p>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;font-size:12px;color:#666">
        <span id="admin-user-label">SesiÃ³n de administrador</span>
        <a href="index.html" class="btn secondary" style="padding:4px 10px;font-size:12px">â† Volver al inicio</a>
      </div>
    </header>

    <!-- Resumen rÃ¡pido -->
    <section class="card" style="margin-bottom:16px">
      <h2 style="margin-top:0;font-size:15px">Resumen general</h2>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;font-size:13px">
        <div style="padding:8px;border-radius:10px;background:#fff7ed;border:1px solid #fed7aa">
          <div style="font-size:11px;text-transform:uppercase;color:#9a3412;letter-spacing:.04em">Platillos</div>
          <div id="stat-platillos" style="font-size:18px;font-weight:600">â€“</div>
          <div style="font-size:11px;color:#9a3412">En el menÃº</div>
        </div>
        <div style="padding:8px;border-radius:10px;background:#f0fdf4;border:1px solid #bbf7d0">
          <div style="font-size:11px;text-transform:uppercase;color:#166534;letter-spacing:.04em">CategorÃ­as</div>
          <div id="stat-categorias" style="font-size:18px;font-weight:600">â€“</div>
          <div style="font-size:11px;color:#166534">Agrupando el menÃº</div>
        </div>
        <div style="padding:8px;border-radius:10px;background:#eff6ff;border:1px solid #bfdbfe">
          <div style="font-size:11px;text-transform:uppercase;color:#1d4ed8;letter-spacing:.04em">Reservaciones</div>
          <div id="stat-reservas" style="font-size:18px;font-weight:600">â€“</div>
          <div style="font-size:11px;color:#1d4ed8">Registros totales</div>
        </div>
        <div style="padding:8px;border-radius:10px;background:#fef2f2;border:1px solid #fecaca">
          <div style="font-size:11px;text-transform:uppercase;color:#b91c1c;letter-spacing:.04em">Pedidos</div>
          <div id="stat-pedidos" style="font-size:18px;font-weight:600">â€“</div>
          <div style="font-size:11px;color:#b91c1c">Pedidos registrados</div>
        </div>
        <div style="padding:8px;border-radius:10px;background:#f5f3ff;border:1px solid #ddd6fe">
          <div style="font-size:11px;text-transform:uppercase;color:#5b21b6;letter-spacing:.04em">ReseÃ±as pendientes</div>
          <div id="stat-resenas-pend" style="font-size:18px;font-weight:600">â€“</div>
          <div style="font-size:11px;color:#5b21b6">Por revisar</div>
        </div>
        <div style="padding:8px;border-radius:10px;background:#ecfeff;border:1px solid #a5f3fc">
          <div style="font-size:11px;text-transform:uppercase;color:#0f766e;letter-spacing:.04em">Usuarios</div>
          <div id="stat-usuarios" style="font-size:18px;font-weight:600">â€“</div>
          <div style="font-size:11px;color:#0f766e">Registrados en el sistema</div>
        </div>
      </div>
    </section>

    <!-- MÃ³dulos -->
    <section class="card">
      <h2 style="margin-top:0;font-size:15px">MÃ³dulos de administraciÃ³n</h2>

      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:12px;margin-top:8px">

        <!-- Platillos y categorÃ­as -->
        <a href="admin-platillos.html" class="card"
           style="text-decoration:none;border:1px solid #e5e7eb;transition:box-shadow .15s,transform .15s;cursor:pointer">
          <div style="display:flex;align-items:flex-start;gap:8px">
            <div style="font-size:22px">ğŸ½ï¸</div>
            <div style="flex:1 1 auto">
              <h3 style="margin:0 0 4px;font-size:14px">Platillos y categorÃ­as</h3>
              <p style="margin:0 0 8px;font-size:12px;color:#555">
                Agrega, edita o elimina platillos del menÃº y organiza las categorÃ­as.
              </p>
              <div style="display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#666">
                <span><strong id="mod-platillos-count">â€“</strong> platillos Â· <strong id="mod-categorias-count">â€“</strong> categorÃ­as</span>
                <span style="color:#2563eb;font-weight:500">Administrar â†’</span>
              </div>
            </div>
          </div>
        </a>

        <!-- Reservaciones -->
        <a href="admin-reservaciones.html" class="card"
           style="text-decoration:none;border:1px solid #e5e7eb;transition:box-shadow .15s,transform .15s;cursor:pointer">
          <div style="display:flex;align-items:flex-start;gap:8px">
            <div style="font-size:22px">ğŸ“…</div>
            <div style="flex:1 1 auto">
              <h3 style="margin:0 0 4px;font-size:14px">Reservaciones</h3>
              <p style="margin:0 0 8px;font-size:12px;color:#555">
                Revisa, confirma o cancela reservaciones de mesa realizadas por los clientes.
              </p>
              <div style="display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#666">
                <span><strong id="mod-reservas-count">â€“</strong> reservaciones</span>
                <span style="color:#2563eb;font-weight:500">Ver reservaciones â†’</span>
              </div>
            </div>
          </div>
        </a>

        <!-- Pedidos -->
        <a href="admin-pedidos.html" class="card"
           style="text-decoration:none;border:1px solid #e5e7eb;transition:box-shadow .15s,transform .15s;cursor:pointer">
          <div style="display:flex;align-items:flex-start;gap:8px">
            <div style="font-size:22px">ğŸ§¾</div>
            <div style="flex:1 1 auto">
              <h3 style="margin:0 0 4px;font-size:14px">Pedidos</h3>
              <p style="margin:0 0 8px;font-size:12px;color:#555">
                Consulta los pedidos realizados, su detalle y cambia el estado (en proceso, listo, entregado).
              </p>
              <div style="display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#666">
                <span><strong id="mod-pedidos-count">â€“</strong> pedidos</span>
                <span style="color:#2563eb;font-weight:500">Gestionar pedidos â†’</span>
              </div>
            </div>
          </div>
        </a>

        <!-- ReseÃ±as -->
        <a href="admin-resenas.html" class="card"
           style="text-decoration:none;border:1px solid #e5e7eb;transition:box-shadow .15s,transform .15s;cursor:pointer">
          <div style="display:flex;align-items:flex-start;gap:8px">
            <div style="font-size:22px">â­</div>
            <div style="flex:1 1 auto">
              <h3 style="margin:0 0 4px;font-size:14px">ReseÃ±as de clientes</h3>
              <p style="margin:0 0 8px;font-size:12px;color:#555">
                Revisa los comentarios, aprueba o rechaza reseÃ±as para mostrar en la pÃ¡gina pÃºblica.
              </p>
              <div style="display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#666">
                <span><strong id="mod-resenas-pend-count">â€“</strong> pendientes</span>
                <span style="color:#2563eb;font-weight:500">Revisar reseÃ±as â†’</span>
              </div>
            </div>
          </div>
        </a>

        <!-- Usuarios -->
        <a href="admin-usuarios.html" class="card"
           style="text-decoration:none;border:1px solid #e5e7eb;transition:box-shadow .15s,transform .15s;cursor:pointer">
          <div style="display:flex;align-items:flex-start;gap:8px">
            <div style="font-size:22px">ğŸ‘¤</div>
            <div style="flex:1 1 auto">
              <h3 style="margin:0 0 4px;font-size:14px">Usuarios y roles</h3>
              <p style="margin:0 0 8px;font-size:12px;color:#555">
                Administra cuentas de acceso al sistema, roles de administrador o usuario y estado activo.
              </p>
              <div style="display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#666">
                <span><strong id="mod-usuarios-count">â€“</strong> usuarios</span>
                <span style="color:#2563eb;font-weight:500">Administrar usuarios â†’</span>
              </div>
            </div>
          </div>
        </a>

        <!-- Acerca de nosotros -->
        <a href="admin-aboutus.html" class="card"
           style="text-decoration:none;border:1px solid #e5e7eb;transition:box-shadow .15s,transform .15s;cursor:pointer">
          <div style="display:flex;align-items:flex-start;gap:8px">
            <div style="font-size:22px">ğŸ </div>
            <div style="flex:1 1 auto">
              <h3 style="margin:0 0 4px;font-size:14px">Acerca de La Media Docena</h3>
              <p style="margin:0 0 8px;font-size:12px;color:#555">
                Edita la informaciÃ³n pÃºblica del restaurante: nombre, descripciÃ³n, misiÃ³n y visiÃ³n.
              </p>
              <div style="display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#666">
                <span>Contenido institucional</span>
                <span style="color:#2563eb;font-weight:500">Editar informaciÃ³n â†’</span>
              </div>
            </div>
          </div>
        </a>

        <!-- Contacto -->
        <a href="admin-contacto.html" class="card"
           style="text-decoration:none;border:1px solid #e5e7eb;transition:box-shadow .15s,transform .15s;cursor:pointer">
          <div style="display:flex;align-items:flex-start;gap:8px">
            <div style="font-size:22px">ğŸ“¨</div>
            <div style="flex:1 1 auto">
              <h3 style="margin:0 0 4px;font-size:14px">Mensajes de contacto</h3>
              <p style="margin:0 0 8px;font-size:12px;color:#555">
                MÃ³dulo para centralizar mensajes enviados desde la pÃ¡gina de contacto.
                (Se puede conectar despuÃ©s a la base de datos o correo).
              </p>
              <div style="display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#666">
                <span><strong id="mod-contactos-count">â€“</strong> mensajes</span>
                <span style="color:#2563eb;font-weight:500">Ver mensajes â†’</span>
              </div>
            </div>
          </div>
        </a>

      </div>
    </section>
  </main>

  <script>
    const API_BASE = "http://127.0.0.1:5000/api";

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value;
    }

    async function cargarDashboard() {
      try {
        const [
          resPlatillos,
          resCategorias,
          resPedidos,
          resReservas,
          resResenasPend,
          resUsuarios
        ] = await Promise.all([
          fetch(`${API_BASE}/platillos`),
          fetch(`${API_BASE}/categorias`),
          fetch(`${API_BASE}/pedidos`),
          fetch(`${API_BASE}/reservaciones`),
          fetch(`${API_BASE}/resenas?estado=pendiente`),
          fetch(`${API_BASE}/usuarios`)
        ]);

        const platillos = await resPlatillos.json().catch(() => []);
        const categorias = await resCategorias.json().catch(() => []);
        const pedidos = await resPedidos.json().catch(() => []);
        const reservas = await resReservas.json().catch(() => []);
        const resenasPend = await resResenasPend.json().catch(() => []);
        const usuarios = await resUsuarios.json().catch(() => []);

        const totalPlatillos = Array.isArray(platillos) ? platillos.length : 0;
        const totalCategorias = Array.isArray(categorias) ? categorias.length : 0;
        const totalPedidos = Array.isArray(pedidos) ? pedidos.length : 0;
        const totalReservas = Array.isArray(reservas) ? reservas.length : 0;
        const totalResenasPend = Array.isArray(resenasPend) ? resenasPend.length : 0;
        const totalUsuarios = Array.isArray(usuarios) ? usuarios.length : 0;

        // Resumen
        setText("stat-platillos", totalPlatillos);
        setText("stat-categorias", totalCategorias);
        setText("stat-pedidos", totalPedidos);
        setText("stat-reservas", totalReservas);
        setText("stat-resenas-pend", totalResenasPend);
        setText("stat-usuarios", totalUsuarios);

        // MÃ³dulos
        setText("mod-platillos-count", totalPlatillos);
        setText("mod-categorias-count", totalCategorias);
        setText("mod-pedidos-count", totalPedidos);
        setText("mod-reservas-count", totalReservas);
        setText("mod-resenas-pend-count", totalResenasPend);
        setText("mod-usuarios-count", totalUsuarios);

        // Contactos todavÃ­a no estÃ¡n conectados a BD, dejamos "â€“"
        setText("mod-contactos-count", "â€“");
      } catch (err) {
        console.error("Error cargando el dashboard de admin:", err);
        // Si algo truena, dejamos los guiones para no romper la vista
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Proteger admin si mÃ¡s adelante agregas esta funciÃ³n
      if (window.$app && typeof $app.requireAdmin === "function") {
        $app.requireAdmin();
      }

      // Mostrar nombre del usuario si estÃ¡ en localStorage
      if (window.$app && typeof $app.getUser === "function") {
        const user = $app.getUser();
        if (user && user.name) {
          const lbl = document.getElementById("admin-user-label");
          if (lbl) lbl.textContent = `SesiÃ³n: ${user.name} (${user.role || "usuario"})`;
        }
      }

      cargarDashboard();
    });
  </script>
</body>
</html>
